<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./main.css">
    <title>Document</title>
</head>

<body>
    <main>
        <form id="user-form">
            <h2>添加用户</h2>
            <input type="number" name="index" hidden>
            <input type="text" name="username" placeholder="用户名">
            <input type="text" name="email" placeholder="邮箱">
            <input type="number" name="balance" placeholder="余额">
            <button type="submit">提交</button>
        </form>

        <table id="user-table">
            <thead>
                <th>用户名</th>
                <th>邮箱</th>
                <th>余额</th>
                <th class="text-right">操作</th>
            </thead>
            <tbody></tbody>
        </table>
    </main>
    <script src="./main.js"></script>
    <!-- <script>
        ;
        (function () {
            // 表单数据
            let userList = [{
                    username: '熙洪氏',
                    email: 'sdasd@asd.com',
                    balance: 26,
                },
                {
                    username: '肉汤圆',
                    email: 'ssdr@123.com',
                    balance: 12,
                },
            ];
            let elForm = document.getElementById('user-form'),
                elTable,
                elTbody;
            // 为了便于管理，将四个input放到一个对象里 
            let inputs = {
                index: elForm.querySelector('[name=index]'),
                username: elForm.querySelector('[name=username]'),
                email: elForm.querySelector('[name=email]'),
                balance: elForm.querySelector('[name=balance]'),
            };

            boot();

            function boot() {
                elForm = document.getElementById('user-form');
                elTable = document.getElementById('user-table');
                elTbody = elTable.tBodies[0];
                render();
                bindSubmit();
            }
            // 绑定提交表单事件
            function bindSubmit() {
                // 取消提交跳转
                elForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    // 用来存取用户输入的信息
                    let data = {};
                    // 获取<input name=index>的值,这个值是判断当前提交到底是新增还是更新的依据,因为只有更新的数据有索引（id）
                    let index = inputs.index.value;
                    // 拿到form中所有有name属性的元素并循环，通过属性名拿到对应的属性值
                    let checked = elForm.querySelectorAll('[name]');
                    checked.forEach(input => {
                        data[input.name] = input.value;
                    });
                    // 是不是更新操作？
                    index ?
                        userList[index] = data : // 有的话就更新数据
                        userList.push(data); // 没有的话就推入
                    // 拿到数据后清空表单
                    elForm.reset();
                    //再次渲染
                    render();
                });
            }
            // 渲染
            function render() {
                elTbody.innerHTML = '';
                // 将数据渲染到 table里
                userList.forEach((user, index) => {
                    //当删除某一项数据后为null的话，就直接返回
                    if (!user)
                        return;
                    let tr = document.createElement('tr');
                    tr.innerHTML =
                        `
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.balance}</td>
                    <td class='text-right operation'><button class='delete'>删除</button><button class='fill'>更新</button></td>
                    `;
                    // 通过查找事件源的方式动态绑定操作事件
                    let opr = tr.querySelector('.operation');
                    opr.addEventListener('click', (event) => {
                        let target = event.target;
                        if (target.classList.contains('delete')) {
                            userList[index] = null;
                            tr.remove();
                        }
                        // 如果是"更新"按钮（其实是填充）
                        if (target.classList.contains('fill')) {
                            // 就用当前行的数据填充表单
                            inputs.username.value = user.username;
                            inputs.email.value = user.email;
                            inputs.balance.value = user.balance;
                            // 这个特殊，index作为提交时判断新增还是更新的依据，所以必须填上，如果不填，那么提交后就会新增一条数据（相当于
                            // 复制本条数据）
                            inputs.index.value = index;
                        }
                    })
                    elTbody.appendChild(tr);
                });
            }
        })();
    </script> -->
</body>

</html>